<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CDAKit  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="CDAKit  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">CDAKit Docs</a> (81% documented)</p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">CDAKit Reference</a>
        <img id="carat" src="img/carat.png" />
        CDAKit  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/CDAKAddress.html">CDAKAddress</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKAllergy.html">CDAKAllergy</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKCDAIdentifier.html">CDAKCDAIdentifier</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKCareGoal.html">CDAKCareGoal</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKCodeSystemHelper.html">CDAKCodeSystemHelper</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKCodedResultValue.html">CDAKCodedResultValue</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKCommunication.html">CDAKCommunication</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKCondition.html">CDAKCondition</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKEncounter.html">CDAKEncounter</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKEntry.html">CDAKEntry</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKEntryDetail.html">CDAKEntryDetail</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKExport.html">CDAKExport</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKFacility.html">CDAKFacility</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKFamilyHistory.html">CDAKFamilyHistory</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKFulfillmentHistory.html">CDAKFulfillmentHistory</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKFunctionalStatus.html">CDAKFunctionalStatus</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKGlobals.html">CDAKGlobals</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKGuarantor.html">CDAKGuarantor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKHKRecord.html">CDAKHKRecord</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKHL7Helper.html">CDAKHL7Helper</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKHealthKitBridge.html">CDAKHealthKitBridge</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKImmunization.html">CDAKImmunization</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKInsuranceProvider.html">CDAKInsuranceProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKLabResult.html">CDAKLabResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKMedicalEquipment.html">CDAKMedicalEquipment</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKMedication.html">CDAKMedication</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKOrderInformation.html">CDAKOrderInformation</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKOrganization.html">CDAKOrganization</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKPerson.html">CDAKPerson</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKPhysicalQuantityResultValue.html">CDAKPhysicalQuantityResultValue</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKProcedure.html">CDAKProcedure</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKProvider.html">CDAKProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKProviderPerformance.html">CDAKProviderPerformance</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes.html#/s:C6CDAKit22CDAKProviderPreference">CDAKProviderPreference</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKQRDAAuthor.html">CDAKQRDAAuthor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKQRDACustodian.html">CDAKQRDACustodian</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKQRDADevice.html">CDAKQRDADevice</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKQRDAHeader.html">CDAKQRDAHeader</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKQRDALegalAuthenticator.html">CDAKQRDALegalAuthenticator</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKReason.html">CDAKReason</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKRecord.html">CDAKRecord</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKReference.html">CDAKReference</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKResultValue.html">CDAKResultValue</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes.html#/s:C6CDAKit17CDAKSocialHistory">CDAKSocialHistory</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKSupport.html">CDAKSupport</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKTelecom.html">CDAKTelecom</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKTransfer.html">CDAKTransfer</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKTreatingProvider.html">CDAKTreatingProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CDAKVitalSign.html">CDAKVitalSign</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/CDAKConfidentialityCodes.html">CDAKConfidentialityCodes</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/CDAKHKMetadataKeys.html">CDAKHKMetadataKeys</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/CDAKImportError.html">CDAKImportError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/s:ZF6CDAKitoi2eeFTCS_17CDAKCDAIdentifierS0__Sb">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:ZF6CDAKitoi2eeFTCS_16CDAKOrganizationS0__Sb">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:ZF6CDAKitoi2eeFTCS_12CDAKProviderS0__Sb">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:ZF6CDAKitoi2eeFTCS_31CDAKPhysicalQuantityResultValueS0__Sb">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:ZF6CDAKitoi2eeFTVS_14CDAKCodedEntryS0__Sb">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:ZF6CDAKitoi2eeFTVS_16CDAKCodedEntriesS0__Sb">==(_:_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/CDAKJSONExportable.html">CDAKJSONExportable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/CDAKThingWithCodes.html">CDAKThingWithCodes</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/CDAKThingWithIdentifier.html">CDAKThingWithIdentifier</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/CDAKThingWithTimes.html">CDAKThingWithTimes</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structs</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/CDAKCodedEntries.html">CDAKCodedEntries</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CDAKCodedEntry.html">CDAKCodedEntry</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CDAKConceptHelpers.html">CDAKConceptHelpers</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CDAKMedicationAdministrationTiming.html">CDAKMedicationAdministrationTiming</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CDAKMedicationRestriction.html">CDAKMedicationRestriction</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CDAKValueAndUnit.html">CDAKValueAndUnit</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CDAKVocabularyKeys.html">CDAKVocabularyKeys</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:V6CDAKit13code_and_name">code_and_name</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p><img src="https://raw.githubusercontent.com/ewhitley/CDAKit/master/github_assets/CDAKitGithubLogo.png" alt="CDAKit Logo" title="CDAKit Logo"></p>

<p><a href="https://cocoapods.org/pods/CDAKit"><img src="https://img.shields.io/cocoapods/v/CDAKit.svg" alt="CocoaPods Compatible"></a>
<a href="https://opensource.org/licenses/Apache-2.0"><img src="https://img.shields.io/cocoapods/l/CDAKit.svg?style=flat&amp;color=gray" alt="License"></a></p>
<a href='#cdakit' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='cdakit'>CDAKit</h1>

<p><strong>CDAKit for iOS, the Open Source Clinical Document Architecture Library with HealthKit Connectivity.  Helping you quickly manage CDA-structured health data.</strong> </p>

<ul>
<li>CDAKit GitHub - <a href="https://github.com/ewhitley/CDAKit">Source</a></li>
<li>Additional <a href="https://ewhitley.github.io/CDAKit">documentation</a></li>
<li>Current Version: 1.0.2.  <a href="https://github.com/ewhitley/CDAKit/blob/master/release-notes.md">Revision History</a></li>
</ul>

<p>CDAKit provides C32 and C-CDA import and export functionality as well as the ability to connect CDA concepts with HealthKit samples.  This allows for bridging between CDA and HealthKit so you can integrate with an Electronic Medical Records system.</p>

<p>CDAKit&rsquo;s models, importer, and exporter are based on the Ruby <a href="https://github.com/projectcypress/health-data-standards">Health-Data-Standards</a> project (HDS), which was funded by the US Office of the National Coordinator for Health Information Technology (<a href="https://www.healthit.gov">ONC</a>) and built primarily by MITRE Corporation (<a href="http://mitre.org">MITRE</a>). </p>

<p>You can read more about some of the rationale behind CDAKit here: <a href="https://www.linkedin.com/pulse/connecting-ios-your-emr-using-healthkit-cda-part-one-eric-whitley">LinkedIn posts</a>.  </p>

<ul>
<li><a href="#features">Features</a></li>
<li><a href="#fast_track">The Fast Track</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#basic_models">Basic Models</a>

<ul>
<li><a href="#coded_data">Coded Data</a></li>
</ul></li>
<li><a href="#basic_methods">Basic Methods</a>

<ul>
<li><a href="#import_cda_xml">Importing from CDA XML</a></li>
<li><a href="#export_cda_xml">Exporting to CDA XML</a></li>
<li><a href="#import_cda_xml_unsupported">Importing: Enabling Support for <q>Indeterminate</q> CDA Formats</a></li>
</ul></li>
<li><a href="#healthkit_bridge">HealthKit Bridge</a>

<ul>
<li><a href="#cda_to_healthkit">CDA to HealthKit</a></li>
<li><a href="#healthkit_to_cda">HealthKit to CDA</a></li>
<li><a href="#healthkit_change_single_unit">Overriding CDA-Based Units Explicitly</a></li>
<li><a href="#healthkit_change_preference_unit">Overriding Units Based on User Preferences</a></li>
<li><a href="#healthkit_vocabs_and_units">Vocabulary and Unit Mappings</a>

<ul>
<li><a href="#healthkit_vocabs_and_units_vocabs">Vocabulary Mapping</a></li>
<li><a href="#healthkit_vocabs_and_units_units">Unit Mapping</a></li>
</ul></li>
<li><a href="#healthkit_sample_metadata">Searching for HealthKit Samples Imported from CDA</a></li>
</ul></li>
</ul>
<a href='#the_cdakit_team' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='the_cdakit_team'>The CDAKit Team</h3>

<ul>
<li><a href="http://linkedin.com/in/ericwhitley">Eric Whitley</a></li>
<li><a href="https://www.linkedin.com/in/saritakeni">Dr. Sarita Keni</a></li>
</ul>
<a href='#special_thanks' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='special_thanks'>Special Thanks</h3>

<p>CDAKit wouldn&rsquo;t exist without the Ruby <a href="https://github.com/projectcypress/health-data-standards">Health-Data-Standards</a> library. In particular, the following individuals whose leadership, commitment, and hard work are helping drive healthcare interoperability:</p>

<ul>
<li>The ONC - <a href="https://www.linkedin.com/in/kevin-larsen-25a9a511">Dr. Kevin Larsen</a> and <a href="https://www.linkedin.com/in/johnrancourt">John Rancourt</a>, who championed and managed so many key interoperability projects.</li>
<li>MITRE Corporation - Simply too many to list. All the great people involved in <a href="https://github.com/projectcypress/health-data-standards">Health-Data-Standards</a>, <a href="https://github.com/projectcypress">Cypress</a>, <a href="https://www.osehra.org/popHealth">popHealth</a>, <a href="https://bonnie.healthit.gov">Bonnie</a>, and more.</li>
<li>Northwestern - <a href="https://www.linkedin.com/in/lukevrasmussen">Luke Rasmussen</a> and <a href="https://www.linkedin.com/in/abel-kho-8170477">Dr. Abel Kho</a>, the de facto leadership in medical informatics and analytics on campus.</li>
</ul>
<a href='#a_name_features_a_features' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='a_name_features_a_features'><a name="features"></a>Features</h1>

<ul>
<li>Create CDA documents (C32 and CCDA)</li>
<li>Import CDA documents (C32 and CCDA)</li>
<li>Bridge to/from HealthKit (for CDA import and export)</li>
</ul>
<a href='#a_name_fast_track_a_the_fast_track' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='a_name_fast_track_a_the_fast_track'><a name="fast_track"></a>The Fast Track</h1>
<pre class="highlight swift"><code>
<span class="k">let</span> <span class="nv">doc</span> <span class="o">=</span> <span class="p">((</span><span class="n">supply</span> <span class="n">your</span> <span class="kt">CDA</span> <span class="kt">XML</span> <span class="n">string</span><span class="p">))</span>

<span class="k">do</span> <span class="p">{</span>
  <span class="c1">//let's try to import from CDA</span>
  <span class="k">let</span> <span class="nv">record</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">CDAKRecord</span><span class="p">(</span><span class="nv">fromXML</span><span class="p">:</span> <span class="n">doc</span><span class="p">)</span>

  <span class="c1">//let's create a new vital</span>
  <span class="c1">// use the coded values to govern "meaning" (height, weight, BMI, BP items, etc.)</span>
  <span class="k">let</span> <span class="nv">aVital</span> <span class="o">=</span> <span class="kt">CDAKVitalSign</span><span class="p">()</span>
  <span class="n">aVital</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="nf">addCodes</span><span class="p">(</span><span class="s">"LOINC"</span><span class="p">,</span> <span class="nv">code</span><span class="p">:</span> <span class="s">"3141-9"</span><span class="p">)</span> <span class="c1">//weight</span>
  <span class="n">aVital</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">CDAKPhysicalQuantityResultValue</span><span class="p">(</span><span class="nv">scalar</span><span class="p">:</span> <span class="mf">155.0</span><span class="p">,</span> <span class="nv">units</span><span class="p">:</span> <span class="s">"lb"</span><span class="p">))</span>
  <span class="n">aVital</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kt">NSDate</span><span class="p">()</span><span class="o">.</span><span class="n">timeIntervalSince1970</span>
  <span class="n">aVital</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kt">NSDate</span><span class="p">()</span><span class="o">.</span><span class="n">timeIntervalSince1970</span>

  <span class="c1">//append our height to our record</span>
  <span class="n">record</span><span class="o">.</span><span class="n">vital_signs</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">aVital</span><span class="p">)</span>

  <span class="c1">//OK, let's convert our CDAK record to HealthKit</span>
  <span class="k">let</span> <span class="nv">hkRecord</span> <span class="o">=</span> <span class="kt">CDAKHKRecord</span><span class="p">(</span><span class="nv">fromCDAKRecord</span><span class="p">:</span> <span class="n">record</span><span class="p">)</span>

  <span class="c1">//let's explicitly set our preferred units to metric for a few things</span>
  <span class="kt">CDAKHealthKitBridge</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="kt">CDAKHKQuantityTypeDefaultUnits</span><span class="p">[</span><span class="o">.</span><span class="kt">HKQuantityTypeIdentifierHeight</span><span class="p">]</span> <span class="o">=</span> <span class="s">"cm"</span>
  <span class="kt">CDAKHealthKitBridge</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="kt">CDAKHKQuantityTypeDefaultUnits</span><span class="p">[</span><span class="o">.</span><span class="kt">HKQuantityTypeIdentifierBodyMass</span><span class="p">]</span> <span class="o">=</span> <span class="s">"kg"</span>

  <span class="c1">//now let's convert back from HealthKit to our model</span>
  <span class="k">let</span> <span class="nv">cdakRecord</span> <span class="o">=</span> <span class="n">hkRecord</span><span class="o">.</span><span class="nf">exportAsCDAKRecord</span><span class="p">()</span>

  <span class="c1">//render from our model to CDA - format set to .ccda (could also do .c32)</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">cdakRecord</span><span class="o">.</span><span class="nf">export</span><span class="p">(</span><span class="nv">inFormat</span><span class="p">:</span> <span class="o">.</span><span class="n">ccda</span><span class="p">))</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">{</span>
  <span class="c1">//do something</span>
<span class="p">}</span>

</code></pre>
<a href='#a_name_installation_a_installation' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='a_name_installation_a_installation'><a name="installation"></a>Installation</h1>
<a href='#requirements' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='requirements'>Requirements</h2>

<ul>
<li>iOS 8+</li>
<li>Xcode 7</li>
<li>Swift 2.1</li>
</ul>
<a href='#using_cocoapods' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='using_cocoapods'>Using CocoaPods</h2>

<p>CDAKit is currently distributed through <a href="http://cocoapods.org/">CocoaPods</a>. To install <code>CDAKit</code>, add it to your to your <code>Podfile</code>:</p>
<pre class="highlight ruby"><code><span class="n">platform</span> <span class="ss">:ios</span><span class="p">,</span> <span class="s1">'8.0'</span>
<span class="n">use_frameworks!</span>

<span class="n">target</span> <span class="s1">'MyApp'</span> <span class="k">do</span>
<span class="n">pod</span> <span class="s1">'CDAKit'</span><span class="p">,</span> <span class="s1">'~&gt; 1.0'</span>
<span class="k">end</span>
</code></pre>

<p>Then, run the following command from Terminal:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>pod install
</code></pre>
<a href='#dependencies' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='dependencies'>Dependencies</h2>

<p>CDAKit proudly uses the following projects:</p>

<ul>
<li><a href="https://github.com/cezheng/Fuzi">Fuzi</a> - <q>A fast & lightweight XML & HTML parser in Swift with XPath & CSS support</q> Used for all XPath-based parsing of inbound CDA XML.</li>
<li><a href="https://github.com/groue/GRMustache.swift">GRMustache</a> - <q>Flexible Mustache templates for Swift</q> Swift version of the Mustache templating engine.  Used for CDA XML generation.</li>
<li><a href="https://github.com/Weebly/Try">Try</a> - <q>Handle Objective-C Exceptions with Swift&rsquo;s error handling system</q> There is one specific place (attempting to create an HKUnit from string) where we need to use the more traditional <q>try</q> (with failure) to handle exceptions that Swift can&rsquo;t yet address.</li>
</ul>
<a href='#a_name_usage_a_usage' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='a_name_usage_a_usage'><a name="usage"></a>Usage</h1>

<p>Reference CDAKit in your app</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">CDAKit</span>
</code></pre>
<a href='#a_name_basic_models_a_basic_models' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='a_name_basic_models_a_basic_models'><a name="basic_models"></a>Basic Models</h1>

<p><img src="https://raw.githubusercontent.com/ewhitley/CDAKit/master/github_assets/CDAKRecordModels_Common.png" alt="CDAKit Record Model" title="CDAKit Record Model"></p>

<p>CDAKit uses a <q>Record</q> object (<code>CDAKRecord</code>) that represents the core CDA document.  Within the record are individual entries (<code>CDAKEntry</code>) with various more precise types for elements like encounters, medications, allergies, etc.</p>

<ul>
<li><p><strong>CDAKRecord</strong>: Central record</p>

<ul>
<li>Record header metadata</li>
<li>Patient name, medical record numbers, demographics, gender, etc.</li>
<li>Specific typed arrays of child CDA Entries by type (allergies, encounters, etc.)</li>
</ul></li>
<li><p><strong>CDAKEntry</strong>: Your detailed CDA content. These may either be <code>CDAKEntry</code> or more specific subclasses like <code>CDAKAllergy</code>, <code>CDAKMedication</code>, <code>CDAKEncounter</code>, etc. </p></li>
<li><p><strong>CDAKCodedEntries</strong> and <strong>CDAKCodedEntry</strong>: These represent the pairing (or collections of pairings) or a medical terminology system and a concept code.</p></li>
<li><p><strong>CDAKPhysicalQuantityResultValue</strong>: A pairing of a unit of measure (lb, in, mm, etc.) and an associated value (1, 2.3, 75, etc). </p></li>
</ul>
<a href='#a_name_coded_data_a_coded_data' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a_name_coded_data_a_coded_data'><a name="coded_data"></a>Coded Data</h2>

<p>Entries can contain <code>codes</code> which represent vocabulary-encoded concept codes.  A <q>BMI,</q> for example, can be represented with LOINC:39156-5 (Body mass index (BMI) [Ratio]). In the absence of coded data, the concept is effectively <q>meaningless</q> for the purposes of interoperability.  While you and I may be able to read a textual <q>BMI</q> description, coded vocabulary entries are essential for machines to interpret the <em>intended</em> meaning of a piece of information.</p>

<p>Adding coded data to an Entry</p>
<pre class="highlight swift"><code>  <span class="k">let</span> <span class="nv">aVital</span> <span class="o">=</span> <span class="kt">CDAKVitalSign</span><span class="p">()</span>
  <span class="n">aVital</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="nf">addCodes</span><span class="p">(</span><span class="s">"LOINC"</span><span class="p">,</span> <span class="nv">code</span><span class="p">:</span> <span class="s">"3141-9"</span><span class="p">)</span> <span class="c1">//weight</span>
</code></pre>

<p>The vocabulary keys are flexible, but there are some fixed keys to help ensure concepts that have <q>preferred</q> vocabularies are able to resolve the choice of preferred vs. translation entries.</p>

<p>The list of known, commonly-used keys is available through <code>CDAKVocabularyKeys</code>.</p>

<p>You could then use these constants as follows:</p>
<pre class="highlight swift"><code>      <span class="k">let</span> <span class="nv">aVital</span> <span class="o">=</span> <span class="kt">CDAKVitalSign</span><span class="p">()</span>
      <span class="n">aVital</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="nf">addCodes</span><span class="p">(</span><span class="kt">CDAKVocabularyKeys</span><span class="o">.</span><span class="kt">LOINC</span><span class="p">,</span> <span class="nv">code</span><span class="p">:</span> <span class="s">"3141-9"</span><span class="p">)</span> <span class="c1">//weight</span>
</code></pre>

<p>This is probably preferred just to ensure consistency and ensure any associated OID lookups succeed.</p>

<p>You can also supply an optional descriptive <code>displayName</code> which would appear in the finalized coded results.</p>
<pre class="highlight swift"><code>      <span class="k">let</span> <span class="nv">aVital</span> <span class="o">=</span> <span class="kt">CDAKVitalSign</span><span class="p">()</span>
      <span class="n">aVital</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="nf">addCodes</span><span class="p">(</span><span class="kt">CDAKVocabularyKeys</span><span class="o">.</span><span class="kt">LOINC</span><span class="p">,</span> <span class="nv">code</span><span class="p">:</span> <span class="s">"3141-9"</span><span class="p">,</span> <span class="nv">displayName</span><span class="p">:</span> <span class="s">"Body Weight"</span><span class="p">)</span> <span class="c1">//weight</span>
</code></pre>
<a href='#a_name_basic_methods_a_basic_methods' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='a_name_basic_methods_a_basic_methods'><a name="basic_methods"></a>Basic Methods</h1>
<a href='#a_name_import_cda_xml_a_importing_from_cda_xml' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a_name_import_cda_xml_a_importing_from_cda_xml'><a name="import_cda_xml"></a>Importing from CDA XML</h2>

<p>Import your CDA XML from wherever it might be.  If you need some sample CDA files, Bostron Children&rsquo;s Hospital has set up <a href="https://github.com/chb/sample_ccdas/blob/master/HL7%20Samples/CCD.sample.xml">a great repository</a>.</p>

<p>Once you have your XML, you can <code>try</code> to create a <code>CDAKRecord</code> from it by parsing the <code>String</code>.  The XML is expected to be a well-formed XML document with a <code>ClinicalDocument</code> root element.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">myXML</span><span class="p">:</span><span class="kt">String</span> <span class="o">=</span> <span class="p">((</span><span class="kt">Get</span> <span class="n">some</span> <span class="kt">CDA</span> <span class="kt">XML</span><span class="p">))</span>
<span class="k">do</span> <span class="p">{</span>
  <span class="c1">//try to import some CDA XML</span>
  <span class="k">let</span> <span class="nv">record</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">CDAKRecord</span><span class="p">(</span><span class="nv">fromXML</span><span class="p">:</span> <span class="n">myXML</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>

<p>CDA parsing-specific errors may be of a few types, all defined in <code>CDAKImportError</code></p>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="kt">CDAKImportError</span> <span class="p">:</span> <span class="kt">ErrorType</span> <span class="p">{</span>
  <span class="k">case</span> <span class="kt">NotImplemented</span>
  <span class="k">case</span> <span class="kt">UnableToDetermineFormat</span>
  <span class="k">case</span> <span class="kt">NoClinicalDocumentElement</span>
  <span class="k">case</span> <span class="kt">InvalidXML</span>
<span class="p">}</span>
</code></pre>

<ul>
<li><strong>NotImplemented</strong>: This is a known CDA document type, but the importer doesn&rsquo;t (yet) handle the format</li>
<li><strong>UnableToDetermineFormat</strong>: This appears to be a valid XML file and also a valid <code>ClinicalDocument</code>, but contains no known template OIDs.</li>
<li><strong>NoClinicalDocumentElement</strong>: Could not find a <code>ClinicalDocument</code> root element</li>
<li><strong>InvalidXML</strong>: No XML header</li>
</ul>
<a href='#a_name_export_cda_xml_a_exporting_to_cda_xml' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a_name_export_cda_xml_a_exporting_to_cda_xml'><a name="export_cda_xml"></a>Exporting to CDA XML</h2>

<p>Once your CDAKRecord is populated you can export it to one of the supported CDA XML formats.</p>

<p>The formats are enumerated</p>

<ul>
<li>.c32</li>
<li>.ccda</li>
</ul>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">myOutboundCDAXML</span> <span class="o">=</span> <span class="n">cdakRecord</span><span class="o">.</span><span class="nf">export</span><span class="p">(</span><span class="nv">inFormat</span><span class="p">:</span> <span class="o">.</span><span class="n">ccda</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">myOutboundCDAXML</span><span class="p">)</span>
</code></pre>
<a href='#a_name_import_cda_xml_unsupported_a_importing_enabling_support_for_q_indeterminate_q_cda_formats' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a_name_import_cda_xml_unsupported_a_importing_enabling_support_for_q_indeterminate_q_cda_formats'><a name="import_cda_xml_unsupported"></a>Importing: Enabling Support for <q>Indeterminate</q> CDA Formats</h2>

<p>CDAKit uses the <code>templateId</code> OIDs within the XML file&rsquo;s <code>ClinicalDocument</code> header to determine format (found in <code>bulk_record_importer</code>).</p>

<ul>
<li><strong>C32</strong>: 2.16.840.1.113883.3.88.11.32.1</li>
<li><strong>CCDA</strong>: 2.16.840.1.113883.10.20.22.1.2</li>
<li><strong>QRDA1</strong>: 2.16.840.1.113883.10.20.24.1.2 (<em>Not yet supported and will intentinoally throw an error</em>)</li>
</ul>

<p>By default, failing to detect any of those OIDs will result in a document parsing exception.  Some document templates may contain valid CDA, but will not use one of those OIDs.  They might, instead, use only the <q>US General Realm</q> header.</p>

<ul>
<li><strong><q>MAYBE</q></strong>: 2.16.840.1.113883.10.20.22.1.1 (US General Realm header)</li>
</ul>

<p>You can attempt to find any <q>might be supported</q> files by specifying the <code>attemptNonStandardCDAImport</code> flag in the global CDAKit singleton before attempting import.</p>
<pre class="highlight swift"><code><span class="kt">CDAKGlobals</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="n">attemptNonStandardCDAImport</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre>

<p>From there you can then attempt to import an unspecified CDA file</p>
<pre class="highlight swift"><code>
<span class="kt">CDAKGlobals</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="n">attemptNonStandardCDAImport</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">//enable wider support</span>

<span class="k">let</span> <span class="nv">myCDAXMLWithoutTheRightType</span><span class="p">:</span><span class="kt">String</span> <span class="o">=</span> <span class="p">((</span><span class="kt">Get</span> <span class="n">some</span> <span class="n">non</span><span class="o">-</span><span class="n">standard</span> <span class="kt">CDA</span> <span class="kt">XML</span><span class="p">))</span>
<span class="k">do</span> <span class="p">{</span>
  <span class="c1">//try to import some CDA XML</span>
  <span class="k">let</span> <span class="nv">record</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">CDAKRecord</span><span class="p">(</span><span class="nv">fromXML</span><span class="p">:</span> <span class="nv">myCDAXMLWithoutTheRightType</span><span class="p">:</span><span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<a href='#a_name_healthkit_bridge_a_healthkit_bridge' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='a_name_healthkit_bridge_a_healthkit_bridge'><a name="healthkit_bridge"></a>HealthKit Bridge</h1>

<p>You can transform between the CDA models and HealthKit models in order to bridge the two different representations.  An extended discussion of the approach can be found <a href="https://www.linkedin.com/pulse/connecting-ios-your-emr-using-healthkit-cda-part-one-eric-whitley">here</a>.</p>

<p>This process uses an intermediate <code>CDAKHKRecord</code> model to house the HealthKit samples.  If you have existing HealthKit samples, just just need to add them to the <code>samples</code> collection.  Ideally, you&rsquo;re also able to provide some basic name and gender information.</p>

<p>You will likely experience two challenges:</p>

<ul>
<li>Concept / clinical code mappings: What is a <q>height</q>? How do heights in a CDA file reconcile with heights in HealthKit?</li>
<li>Unit mappings: If I have a measurement of <q>98.6 degF</q> in CDA, how do I transform that into something HealthKit samples can use?</li>
</ul>

<p>The HealthKit bridge provides default behaviors for both of these, but you will almost certainly wish to alter them to suit your specific needs.</p>
<a href='#a_name_cda_to_healthkit_a_cda_to_healthkit' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a_name_cda_to_healthkit_a_cda_to_healthkit'><a name="cda_to_healthkit"></a>CDA to HealthKit</h2>

<p>Importing from CDA to HealthKit can be done fairly quickly by converting a CDA-oriented CDAKRecord into HealthKit-compatible record. To do so, you can just initialize a (HealthKit) <code>CDAKHKRecord</code> from a (CDA) <code>CDAKRecord</code>. </p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">doc</span> <span class="o">=</span> <span class="p">((</span><span class="n">my</span> <span class="kt">CDA</span> <span class="kt">XML</span><span class="p">))</span>
<span class="k">do</span> <span class="p">{</span>
  <span class="c1">//try to import some CDA XML</span>
  <span class="k">let</span> <span class="nv">record</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">CDAKRecord</span><span class="p">(</span><span class="nv">fromXML</span><span class="p">:</span> <span class="n">doc</span><span class="p">)</span>

  <span class="c1">//OK, let's convert our CDAK record to HealthKit</span>
  <span class="k">let</span> <span class="nv">hkRecord</span> <span class="o">=</span> <span class="kt">CDAKHKRecord</span><span class="p">(</span><span class="nv">fromCDAKRecord</span><span class="p">:</span> <span class="n">record</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">sample</span> <span class="k">in</span> <span class="n">hkRecord</span><span class="o">.</span><span class="n">samples</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="c1">//these are all HKQuantitySamples</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<a href='#a_name_healthkit_to_cda_a_healthkit_to_cda' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a_name_healthkit_to_cda_a_healthkit_to_cda'><a name="healthkit_to_cda"></a>HealthKit to CDA</h2>

<p>You can quickly transform a HealthKit <code>CDAKHKRecord</code> into a CDA-oriented <code>CDAKHKRecord</code> using the <code>exportAsCDAKRecord</code> method. This reads all <code>samples</code> in the HealthKit bridging record and attempts to transform the clinical concept and associated unit representations into a CDA structure.</p>
<pre class="highlight swift"><code><span class="c1">//our wrapping record for HealthKit stuff</span>
<span class="k">let</span> <span class="nv">hkRecord</span> <span class="o">=</span> <span class="kt">CDAKHKRecord</span><span class="p">()</span>

<span class="c1">//Let's create a HealthKit height</span>
<span class="k">let</span> <span class="nv">aUnit</span> <span class="o">=</span> <span class="kt">HKUnit</span><span class="p">(</span><span class="nv">fromString</span><span class="p">:</span> <span class="s">"in"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">aQty</span> <span class="o">=</span> <span class="kt">HKQuantity</span><span class="p">(</span><span class="nv">unit</span><span class="p">:</span> <span class="n">aUnit</span><span class="p">,</span> <span class="nv">doubleValue</span><span class="p">:</span> <span class="mi">72</span> <span class="p">)</span>
<span class="k">let</span> <span class="nv">aQtyType</span> <span class="o">=</span> <span class="kt">HKQuantityType</span><span class="o">.</span><span class="nf">quantityTypeForIdentifier</span><span class="p">(</span><span class="kt">HKQuantityTypeIdentifierHeight</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">hkHeight</span> <span class="o">=</span> <span class="kt">HKQuantitySample</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="n">aQtyType</span><span class="o">!</span><span class="p">,</span> <span class="nv">quantity</span><span class="p">:</span> <span class="n">aQty</span><span class="p">,</span> <span class="nv">startDate</span><span class="p">:</span> <span class="kt">NSDate</span><span class="p">(),</span> <span class="nv">endDate</span><span class="p">:</span> <span class="kt">NSDate</span><span class="p">())</span>

<span class="c1">//store the sample in our record</span>
<span class="n">hkRecord</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">hkHeight</span><span class="p">)</span>

<span class="c1">//convert the HealthKit record to CDAKRecord</span>
<span class="k">let</span> <span class="nv">cdakRecord</span> <span class="o">=</span> <span class="n">hkRecord</span><span class="o">.</span><span class="nf">exportAsCDAKRecord</span><span class="p">()</span>
</code></pre>
<a href='#a_name_healthkit_change_single_unit_a_overriding_cda_based_units_explicitly' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a_name_healthkit_change_single_unit_a_overriding_cda_based_units_explicitly'><a name="healthkit_change_single_unit"></a>Overriding CDA-Based Units Explicitly</h2>

<p>The HealthKit bridge defaults output units to settings managed through a preferences file.  </p>

<p>If you wish to default preferred units for a given set of quantity types you can do so per HealthKit sample type identifier.</p>
<pre class="highlight swift"><code><span class="kt">CDAKHealthKitBridge</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="kt">CDAKHKQuantityTypeDefaultUnits</span><span class="p">[</span><span class="o">.</span><span class="kt">HKQuantityTypeIdentifierHeight</span><span class="p">]</span> <span class="o">=</span> <span class="s">"cm"</span>
</code></pre>

<p>You can modify large groups of default units by changing <code>CDAKHKQuantityTypeDefaultUnits</code>, which is the dictionary where unit maps are stored at runtime.</p>

<p>Example: 
<code>
[&quot;HKQuantityTypeIdentifierBasalBodyTemperature&quot;, &quot;degF&quot;]
</code></p>

<p>This is initially loaded from the local <code>CDAKitDefaultSampleTypeIdentifierSettings</code> resource file in CDAKit.</p>

<p>The plist uses the <code>unit</code> key and associated <code>string</code> value</p>
<pre class="highlight plaintext"><code>  &lt;key&gt;HKQuantityTypeIdentifierBasalBodyTemperature&lt;/key&gt;
  &lt;dict&gt;
  &lt;key&gt;unit&lt;/key&gt;
  &lt;string&gt;degF&lt;/string&gt;
</code></pre>
<a href='#a_name_healthkit_change_preference_unit_a_overriding_units_based_on_user_preferences' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a_name_healthkit_change_preference_unit_a_overriding_units_based_on_user_preferences'><a name="healthkit_change_preference_unit"></a>Overriding Units Based on User Preferences</h2>

<p>If you want to export HealthKit objects, you may want to let the user&rsquo;s personal unit settings drive the HKUnit selection (where possible).  For example, we may import a <q>body temperature</q> in Fahrenheit, but a user may prefer to see that information rendered in Celsius.  If their personal unit settings for a quantity type are set, this will overwrite the global defaults with the user&rsquo;s preferred setting.</p>

<p>This feature uses HKHealthStore.  It is assumed all authorizations will be managed by your application.</p>

<p>This functionality modifies the HealthKit samples - NOT the native CDA data stored in the CDAKRecord.  You must set the unit preferences BEFORE you export a HKRecord (exportAsCDAKRecord).  Once exported to a CDAKRecord, any changes to the bridge&rsquo;s unit types will not be reflected.  CDA unit types are fixed strings.</p>

<p>HealthKit does this on a background thread, so be careful how you handle things on the UI.</p>
<pre class="highlight swift"><code><span class="c1">//create an instance of the HealthKit management service</span>
<span class="k">let</span> <span class="nv">healthKitStore</span><span class="p">:</span><span class="kt">HKHealthStore</span> <span class="o">=</span> <span class="kt">HKHealthStore</span><span class="p">()</span>
<span class="c1">//NOTE: you'd need to handle authorizations for your specific sample types</span>

<span class="c1">//attempt to set the HealthKit bridge's desired target units to whatever the user's device preferences might be</span>
<span class="kt">CDAKHealthKitBridge</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="nf">setCDAKUnitTypesWithUserSettings</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">healthManager</span><span class="o">.</span><span class="n">healthKitStore</span><span class="p">)</span>
</code></pre>
<a href='#a_name_healthkit_vocabs_and_units_a_vocabulary_and_unit_mappings' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a_name_healthkit_vocabs_and_units_a_vocabulary_and_unit_mappings'><a name="healthkit_vocabs_and_units"></a>Vocabulary and Unit Mappings</h2>

<p>This is the most complex and <q>personal preference</q> aspect of mapping between HealthKit and CDA.  When, for example, you export a HealthKit glucose <code>HKQuantityTypeIdentifierBloodGlucose</code> sample to CDA, which clinical vocabulary and concept code would you like to use?  Which measurement units would be most appropriate? Likewise, when importing from CDA to HealthKit, how do you infer that <q>LOINC:2345-7</q> is a blood glucose measurement?  And how do you transform the variety of CDA-based UCUM units into Apple&rsquo;s expected <q>mg/dl</q>?</p>

<p>To help, CDAKit provides two key mechanisms:</p>

<ul>
<li>A vocabulary mapping system: This simply takes a HealthKit sample type identifier like <code>HKQuantityTypeIdentifierBloodGlucose</code> and asserts a specific set of vocabulary types and coded values</li>
<li>A unit mapping closure: This attempts to interpret the variety of inbound CDA units and transform them into a HealthKit-compatible representation. This is defaulted, but the <code>cdaStringUnitFinder</code> closure variable may (and should) be used by developers to change this behavior to suit their particular needs.</li>
</ul>
<a href='#a_name_healthkit_vocabs_and_units_vocabs_a_vocabulary_mapping' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='a_name_healthkit_vocabs_and_units_vocabs_a_vocabulary_mapping'><a name="healthkit_vocabs_and_units_vocabs"></a>Vocabulary Mapping</h3>

<p>Vocabulary mapping simply tries to tie a HealthKit quantity sample type identifier to a set of known vocabulary types and associated codes.</p>

<p>In CDA, you might receive a lab result with the following coded entry XML:</p>
<pre class="highlight plaintext"><code>&lt;code 
  codeSystem="2.16.840.1.113883.6.1"
  codeSystemName="LOINC" 
  code="2345-7" 
  displayName="Glucose, Serum" /&gt;
</code></pre>

<p>How do we transform that into a <code>HKQuantityTypeIdentifierBloodGlucose</code>?</p>

<p>We simply provide a map from <q>LOINC:2345-7</q> to <code>HKQuantityTypeIdentifierBloodGlucose</code>.</p>

<p>CDAKit provides two maps to help with this:</p>

<ul>
<li><code>import</code> : used exclusively when importing values from CDA to HealthKit</li>
<li><code>export</code> : used exclusively when exporting values from HealthKit to CDA</li>
</ul>

<p>CDAKit provides default curated <q>starter</q> maps, but you can override all values via the <code>loadHealthKitTermMap</code> method.  This method accepts a Swift dictionary [String:AnyObject] based on a structure defined below: </p>

<ul>
<li>The primary key is HealthKit sample type identifier you wish to bind.</li>
<li>Within this, there is a child array bound to the key/tag CDAKit uses to map to a vocabulary.  EX: <q>LOINC</q> or <q>SNOMED-CT</q>.  This declares that all following coded entries within the array will be of that specified vocabulary.</li>
<li>Details for <code>code</code>, <code>displayName</code>, and mapping restriction.  <code>code</code> is the vocabulary concept code (EX: 39156-5) for the associated <code>displayName</code> (EX: <q>Body mass index (BMI) [Ratio]</q>).</li>
</ul>
<pre class="highlight plaintext"><code>   &lt;key&gt;HKQuantityTypeIdentifierBodyMassIndex&lt;/key&gt;
   &lt;dict&gt;
            &lt;key&gt;LOINC&lt;/key&gt;
            &lt;array&gt;
   &lt;dict&gt;
   &lt;key&gt;code&lt;/key&gt;
   &lt;string&gt;39156-5&lt;/string&gt;
   &lt;key&gt;displayName&lt;/key&gt;
   &lt;string&gt;Body mass index (BMI) [Ratio]&lt;/string&gt;
   &lt;key&gt;mapRestriction&lt;/key&gt;
   &lt;string&gt;both&lt;/string&gt;
   &lt;/dict&gt;
            &lt;/array&gt;
   ... (more vocabularies)
   &lt;/dict&gt; 
</code></pre>
<a href='#a_name_healthkit_vocabs_and_units_units_a_unit_mapping' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='a_name_healthkit_vocabs_and_units_units_a_unit_mapping'><a name="healthkit_vocabs_and_units_units"></a>Unit Mapping</h3>

<p>The default unit mapping is a prototype and very brittle.  It simply uses a combination of regular expressions and <q>best guesses</q> to attempt to transform a set of UCUM-like unit strings into something HealthKit can utilize.</p>

<p>If developers have known CDA structures they would like to handle, it is suggested that they override the default unit matching algorithm.</p>

<p>To do so, simply provide your own custom closure via the <code>cdaStringUnitFinder</code> variable.</p>
<pre class="highlight swift"><code>  <span class="kd">public</span> <span class="k">var</span> <span class="nv">cdaStringUnitFinder</span> <span class="p">:</span> <span class="p">((</span><span class="nv">unit_string</span><span class="p">:</span> <span class="kt">String</span><span class="p">?,</span> <span class="nv">typeIdentifier</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">HKUnit</span><span class="p">?)?</span>
</code></pre>

<p>This mock example would simply look for anything like <q>beats</q> and transform it into the HealthKit-compatible <q>count/min</q>.</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">cdaStringUnitFinder</span> <span class="p">:</span> <span class="p">((</span><span class="nv">unit_string</span><span class="p">:</span> <span class="kt">String</span><span class="p">?,</span> <span class="nv">typeIdentifier</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">HKUnit</span><span class="p">?)</span> <span class="o">=</span> <span class="p">{</span>
   <span class="p">(</span><span class="nv">unit_string</span><span class="p">:</span> <span class="kt">String</span><span class="p">?,</span> <span class="nv">typeIdentifier</span><span class="p">:</span> <span class="kt">String</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">HKUnit</span><span class="p">?</span> <span class="k">in</span>

   <span class="k">if</span> <span class="n">unit_string</span> <span class="o">==</span> <span class="s">"beats"</span> <span class="p">{</span>
     <span class="k">return</span> <span class="kt">HKUnit</span><span class="p">(</span><span class="nv">fromString</span><span class="p">:</span> <span class="s">"count/min"</span><span class="p">)</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>

    <span class="c1">//Tell CDAKit to use your custom unit finder</span>
    <span class="kt">CDAKHealthKitBridge</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="n">cdaStringUnitFinder</span> <span class="o">=</span> <span class="n">cdaStringUnitFinder</span>
</code></pre>
<a href='#a_name_healthkit_sample_metadata_a_searching_for_healthkit_samples_imported_from_cda' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a_name_healthkit_sample_metadata_a_searching_for_healthkit_samples_imported_from_cda'><a name="healthkit_sample_metadata"></a>Searching for HealthKit Samples Imported from CDA</h2>

<p>HKQuantitySample created by CDAKit&rsquo;s record import process will include a few custom metadata keys. These are intended to help you identify and manage CDA-based samples (merging, deletion, etc.).</p>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="kt">CDAKHKMetadataKeys</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
  <span class="k">case</span> <span class="kt">CDAKMetadataRecordIDRoot</span>
  <span class="k">case</span> <span class="kt">CDAKMetadataEntryHash</span>
<span class="p">}</span>
</code></pre>

<ul>
<li>CDAKMetadataRecordIDRoot: the root (if found) from the source CDA XML file</li>
<li>CDAKMetadataEntryHash: the hash value from the CDA entry</li>
</ul>

<p>You can also supply your own Swift <code>[String:AnyObject]</code> dictionary to add additional custom metadata.</p>
<a href='#license' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='license'>License</h2>

<p>This work is <a href="./LICENSE.txt">Apache 2</a> licensed.</p>

<ul>
<li><a href="./LICENSE">GRMustache</a></li>
<li><a href="./LICENSE">Fuzi</a></li>
<li><a href="./LICENSE.txt">Swift</a></li>
</ul>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2016 <a class="link" href="https://github.com/ewhitley/CDAKit" target="_blank" rel="external">Eric Whitley</a>. All rights reserved. (Last updated: 2016-03-02)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.5.0</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
